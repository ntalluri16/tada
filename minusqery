#!/bin/bash

# Directory to poll
polling_dir="/path/to/directory"

# The base file name (without extension)
base_name="abc"

# File pattern to wait for
ok_pattern="${polling_dir}/${base_name}.ok"

# Timeout duration in seconds (2 minutes)
timeout_duration=120

# Start time
start_time=$(date +%s)

# Poll for the .ok file until timeout or found
while true; do
    # Check if the .ok file exists
    if [[ -f "$ok_pattern" ]]; then
        echo "$ok_pattern found. Proceeding with normal logic..."
        exit 0  # Exit normally if the file is found
    fi

    # Check if 2 minutes have passed
    current_time=$(date +%s)
    elapsed_time=$((current_time - start_time))
    if ((elapsed_time >= timeout_duration)); then
        echo "$ok_pattern not found within 2 minutes. Exiting with error."
        exit 1  # Exit with error if the file is not found within 2 minutes
    fi

    # Sleep for a short time (e.g., 5 seconds) before checking again
    sleep 5
done

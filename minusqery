#!/bin/bash

# Directory to poll
polling_dir="/path/to/directory"

# The base file name (without extension)
base_name="abc"

# File pattern to wait for
ok_pattern="${polling_dir}/${base_name}.ok"

# File pattern to process once the .ok file is found
txt_pattern="${polling_dir}/${base_name}.txt"

# Poll for the .ok file and wait for it to appear
while true; do
    # Check if the .ok file exists
    if [[ -f "$ok_pattern" ]]; then
        echo "$ok_pattern found. Processing the corresponding .txt file..."
        
        # Process the corresponding .txt file
        if [[ -f "$txt_pattern" ]]; then
            echo "Processing $txt_pattern..."
            # Add your processing logic here (e.g., moving, reading, etc.)
            
            # Once processed, remove or rename the .ok file (optional)
            rm "$ok_pattern"
            echo "Processed and removed $ok_pattern."
            break  # Exit the loop after processing
        else
            echo "$txt_pattern not found, waiting for 2 minutes before checking again."
        fi
    else
        echo "$ok_pattern not found, waiting for 2 minutes..."
    fi
    
    # Wait for 2 minutes before checking again
    sleep 120
done
